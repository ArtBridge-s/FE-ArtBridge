<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>작품 업로드 페이지</title>
    <link rel="stylesheet" type="text/css" href="upload.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!--Check logged in-->
    <script>
        let jwtToken = localStorage.getItem('token'); // Check if user is logged in
        if (!jwtToken) {
            window.location.href = "../../index.html" // If user is not logged in, redirect to index.html
        }
    </script>
</head>
<body>
<div class="artwork-info">
    <h1>작품정보를 작성해주세요</h1>
    <form class="form">
        <p class="recommended-size">권장 사이즈 400X250</p>
        <div class="input-group">
            <input type="text" class="input input-upload" placeholder="이미지 첨부" disabled>
            <input type="file" class="btn upload" id="fileUpload">
            <label for="fileUpload" class="fileUpload">파일 선택</label>
        </div>
        <input type="text" class="input" name="artworkName" placeholder="작품 명을 입력해주세요">
        <textarea class="input input-large" placeholder="작품 소개를 입력해주세요 (글자수 제한)"></textarea>
        <input type="text" class="input" placeholder="가격을 입력해주세요">
        <input type="text" class="input" placeholder="작가를  입력해주세요">
        <textarea class="input input-large" placeholder="작품 설명을 해주세요"></textarea>
        <div class="button-group">
            <button type="submit" class="btn btn-small" id="submitBtn">등록</button>
            <button type="reset" class="btn btn-small">취소</button>
        </div>
    </form>
</div>

<div id="loading" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
    <img src="images/loading.gif" alt="">  <!-- Replace with your loading gif -->
</div>

<!--파일 선택 시 파일명 텍스트 필드에 표시-->
<script>
    document.getElementById("fileUpload").onchange = function() {
        document.querySelector(".input-upload").value = this.files[0].name;
    };
</script>

<!--api-->
<script>
    $(document).ready(function () {
        $(".form").on('submit', function (event) {
            event.preventDefault(); // To prevent normal form submission

            $("#submitBtn").prop("disabled", true);  // Disable the submit button
            $("#loading").show();  // Show loading indicator

            let formData = new FormData(this);
            formData.append('artworkDTO', JSON.stringify({
                title: $("input[name='artworkName']").val(),
                shortDescription: $("textarea[name='artworkDescription']").val(),
                artistname: $("input[name='artworkAuthor']").val(),
                longDescription: $("textarea[name='artworkLongDescription']").val(),
            }));
            formData.append('image', $('#fileUpload')[0].files[0]);  // 이미지 파일을 formData에 추가

            let jwtToken = localStorage.getItem('token');  // Retrieve the JWT token from localStorage

            $.ajax({
                url: 'http://tobiasdev.ml/services/artwork/api/artworks',  // Change this to your API URL
                type: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + jwtToken  // Include the JWT token as an Authorization header
                },
                data: formData,
                cache: false,
                contentType: false,
                processData: false,
                success: function (data) {
                    console.log("Artwork successfully uploaded.");
                    console.log(data);  // Log the received data to console

                    // Re-enable the submit button and hide loading indicator
                    $("#submitBtn").prop("disabled", false);
                    $("#loading").hide();
                },
                error: function (xhr, status, error) {
                    console.error("Upload error: " + error);

                    // Re-enable the submit button and hide loading indicator
                    $("#submitBtn").prop("disabled", false);
                    $("#loading").hide();
                }
            });
        });
    });
</script>


</body>
</html>

