<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>전시회 정보 상세 조회 페이지</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta property="twitter:card" content="summary_large_image" />
    <!--파비콘-->
    <link rel="icon" type="image/png" href="images/detail/Favicon.png" />
    <!--폰트 연결-->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&amp;display=swap"
      data-tag="font"
    />
    <!--.css 연결-->
    <link rel="stylesheet" href="detail.css" />
    <link rel="stylesheet" href="menubar.css"/>
    <!--좋아요 관련 JS-->
    <script>
      window.addEventListener('load', function() {
        var image = document.getElementById('like');
        var isLiked = false;  //좋아요 눌렀는지 여부

      // 서버에서 좋아요 여부를 받아와서 isLiked 변수를 설정하는 메소드
      function getIsLikedFromServer() {

      }
      // 이미지 변경하는 메소드
      function changeImage() {
        if (isLiked) {
          image.src = 'images/detail/icon_FilledHeart.png';
        } else {
          image.src = 'images/detail/icon_Heart.png';
        }
      }
      // 페이지 로드시 isLiked 값을 서버에서 받아온 뒤 이미지를 변경
      getIsLikedFromServer();
      changeImage();

      //좋아요 버튼 클릭시
      image.addEventListener('click', function() {
        isLiked = !isLiked;  // 좋아요 반전(좋아요 상태에서 누르면 좋아요 해제, 역도 성립)
        changeImage();
      });
    });
  </script>
  </head>
  <body>
    <!--전체 영역-->
    <div class="Container">
      <!--상단 기본 메뉴 영역-->
      <!--상단 기본 메뉴 영역-->
      <div class="Container-MenuBar">
        <div class="Container-LeftMenu">
          <span class="BrandName"><span>아트브릿지</span></span>
          <a href="../../index.html">
            <img
              alt="Logo image"
              src="images/upload/Logo.png"
              class="ImgLogo"
              draggable="false"
            />
          </a>
          <span class="HomeMenu"><a href="../../index.html">홈</a></span>
          <span class="ArtworkMenu"
            ><a href="../artwork/list.html">작품</a></span
          >
          <span class="ExhibitionMenu"
            ><a href="../exhibition/list.html">전시회</a></span
          >
          <span class="IntroduceMenu"><a href="../introduce/introduce.html">소개</a></span>
          <span class="ArtistMenu"
            ><a href="../artist/list.html">아티스트</a></span
          >
        </div>
        <div class="Container-RightMenu">
          <div class="GroupLoginLogout">
            <span class="TextLogin"
              ><a href="../member/login.html" id="login">LOGIN</a></span
            >
            <span class="TextLogout"
              ><a href="../member/logout.html" id="logout">LOGOUT</a></span
            >
            <span class="TextDelimeter">ㅣ</span>
            <span class="TextMyPage"
              ><a href="../member/mypage.html" id="mypage">마이페이지</a></span
            >
          </div>
          <div class="BtnUploadArtwork">
            <span class="BtnTextUploadArtwork"
              ><a href="../artwork/upload.html">작품 올리기</a></span
            >
          </div>
          <div class="BtnUploadExhibition">
            <span class="BtnTextUploadExhibition"
              ><a href="../exhibition/upload.html">전시회 올리기</a></span
            >
          </div>
          <div class="Container-SearchBar">
            <div class="GroupSearchInputAndButton">
              <input id="input" placeholder="Search" class="TextSearchInput" />
              <a id="searchButton" href="#">
                <img
                  alt="Search Button image"
                  src="images/upload/icon_Search.svg"
                  class="BtnSearch"
                  draggable="false"
                />
              </a>
            </div>
          </div>
        </div>
      </div>
      <!--본문 영역-->
      <div class="Container-Content">
        <div class="Container-Exhibition">
          <span class="ExhibitionName">
            <span id = "exhibitionName">김건우 개인전</span>
          </span>
          <div class="DUContainer">
            <button id="editBtn" type="button">
              <img src="images/detail/edit.png">
            </button>
            <button id="deleteBtn" type="button">
              <img src="images/detail/delete.png">
            </button>
          </div>
          <div class="Conatainer-Uploader">
            <span id = "writerTitle">작성자</span>
            <span> : </span>
            <span id = "username">신짱구</span>
          </span>
          <img
            alt="Exibition Poster image"
            src="images/detail/ExhibitionPoster.png"
            class="ImgPoster"
            id="image"
            draggable="false"
          />
          <span class="ExhibitionDescription">
            <span id="content">
              김건우의 아트브릿지 발표회는 환상적인 작품들을 볼 수 있을 것이다.
              유년기에 그는 "유년기 시골 마을에서 자라며 형성된 동양적인 정서와
              자연"을 추구한다. 작가는 말한다. "자연을 바라보며 편안하고
              행복했던 순간들, 그 안에서 뿜어져 나오는 에너지들을 늘 감사하게
              생각하며 저만의 방식으로 나타내고 있습니다." 체엄적 자연으로부터
              소환하는 유년기 과거의 기억, 그리고 생명 에너지로 변환하는
              표현주의적 추상이 바로 김건우의 본원적 회화 정신이라고 하겠다.
            </span>
          </span>
          <div class="Container-ExhibitionInfo">
            <span class="TitleExhibitionInfo">
              <span>전시 정보</span>
            </span>
            <img
              alt="Underbar image"
              src="images/detail/ExhibitionInfoUnderbar.png"
              class="ImgExhibitionInfoUnderBar"
              draggable="false"
            />
            <img
              alt="ExhibitionInfoBox image"
              src="images/detail/ExhibitionInfoBox.png"
              class="ExhibitionInfoBox"
              draggable="false"
            />
            <img
              alt="ExhibitionInfoBoxHeader image"
              src="images/detail/ExhibitionInfoBoxHeader.png"
              class="ExhibitionInfoBoxHeader"
              draggable="false"
            />
            <img
              alt="Share image"
              src="images/detail/icon_Share.png"
              class="ImgShare"
              id="share"
              draggable="false"
            />
            <img
              alt="Like image"
              src="images/detail/icon_Heart.png"
              class="ImgLike"
              id="like"
              draggable="false"
            />
            <span class="TitleAuthor"><span>작가</span></span>
            <span class="TextAuthor"><span id = "aurthorName">김건우</span></span>
            <span class="TitlePlace"><span>장소</span></span>
            <span class="TextPlace"><span id="location">아트브릿지</span></span>
            <span class="TitlePeriod"><span>기간</span></span>
            <span class="TextPeriod">
              <span id="startDate">2023.05.08</span>
              <span>~</span>
              <span id="endDate">2023.06.15</span>
            </span>
            <span class="TitleTime"><span>시간</span></span>
            <span class="TextTime" >
              <span id="time">15:00~17:40 일요일 휴관</span>
            </span>
            <span class="TitleFee"><span>관람료</span></span>
            <span class="TextFee"><span id="fee">무료</span></span>
            <span class="TitleInquiry"><span>문의</span></span>
            <span class="TextInquiry">
              <span id="contact">02-1234-5678</span>
            </span>
            <span class="TextNotice">
              <span>주최측 사정에 따라 변경될 수 있습니다.</span>
            </span>
          </div>
        </div>
      </div>
    </div>
    <!--검색창 기능-->

    <!-- 데이터 받아오기 -->
    <script>
      const API_BASE_URL = 'http://tobiasdev.ml/services/exhibition/api/exhibitions';
      async function getData() {
      let id = new URL(window.location.href).searchParams.get("id");
      let url = `${API_BASE_URL}/${id}`;
      const response = await fetch(url, {
        method: "GET",
        headers: {
          "Content-Type": "*/*",
        },
      });
      return response.json();
    }

    getData().then((data) => {
      const exhibitionName = document.getElementById("exhibitionName");
      const username = document.getElementById("username");
      const img = document.getElementById("image");
      const authorName = document.getElementById('aurthorName');
      const location = document.getElementById("location");
      const startDate = document.getElementById("startDate");
      const endDate = document.getElementById('endDate');
      const time = document.getElementById("time");
      const fee = document.getElementById("fee");
      const contact = document.getElementById('contact');
      const content = document.getElementById('content');
      content.textContent = data?.content===undefined? '알수없음' :data.content;
      console.log(data);
      img.src =
        data?.imgUrl === undefined
          ? ""
          : data.imgUrl;
      exhibitionName.textContent = data?.title === undefined ? "알 수 없음" : data.title;
      username.textContent =
        data?.createdMemberDTO===undefined?"알수없음":data.createdMemberDTO.name;
        authorName.textContent =
        data?.artistDTO === undefined ? "알 수 없음" : data.artistDTO.name;
        location.textContent = data?.location === undefined ? "알 수 없음" : data.location;
        startDate.textContent = data?.periodDTO === undefined ? "알 수 없음" :  data?.periodDTO.startDate;
        endDate.textContent =data?.periodDTO=== undefined ? "알 수 없음" : data.periodDTO.endDate;
        time.textContent = data?.periodDTO === undefined ? "알 수 없음" : data.periodDTO.time;
        fee.textContent = data?.fee === undefined ? "알 수 없음" : data.fee;
        contact.textContent = data?.contact === undefined ? "알 수 없음" : data.contact;
    });
    </script>
    <script>
      let link = document.getElementById("searchButton");
      let input = document.getElementById("input");
      // 검색 버튼 클릭시 "search/?q="+검색어 주소로 이동
      link.addEventListener("click", (e) => {
        let searchText = input.value;
        e.preventDefault();
        let url = "search/?q=" + encodeURIComponent(searchText);
        window.location.href = url;
      });
    </script>
    <!--공유하기 기능-->
    <script>
      let exhibitionName =  document.getElementById('exhibitionName').textContent;
      let url = "detail.html?exhibitionName=" + encodeURIComponent(exhibitionName);
      //팝업창에서 링크 정보 공유 위해 localStrage에 주소값 setting
      localStorage.setItem('url', url);
      window.addEventListener('load', function() {
        let button = document.getElementById('share');
        button.addEventListener('click', function() {
          let popup = window.open("sharePopupPage.html", "Share", "width=400,height=300");
        });
      });
    </script>
        <!--로그인 상태에 따라 로그인/로그아웃 버튼 보이기-->
        <script>
          window.addEventListener("DOMContentLoaded", (event) => {
            if (localStorage.getItem("token")) {
              document.querySelector(".TextLogin").style.display = "none";
            } else {
              document.querySelector(".TextLogout").style.display = "none";
            }
          });
          //마이페이지 버튼 클릭시 로그인 상태 확인 후 이동 처리
          document.querySelector(".TextMyPage").addEventListener("click", (e) => {
            e.preventDefault();
            if (localStorage.getItem("token")) {
              // 로그인 토큰이 있는 경우 마이페이지로 이동
              window.location.href = "../member/mypage.html";
            } else {
              // 로그인 토큰이 없는 경우 로그인 페이지로 이동
              window.alert("먼저 로그인 해주세요");
              window.location.href = "../member/login.html";
            }
          });
        </script>
        <!--로그아웃 버튼 클릭시 로컬스토리지에서 토큰 삭제-->
        <script>
          document
            .querySelector(".TextLogout")
            .addEventListener("click", (event) => {
              event.preventDefault();
              localStorage.removeItem("token");
              location.reload();
            });
        </script>
<!--해당 글의 작성자라면 수정, 삭제 버튼 표시-->
<script>
  async function getUserId() {
   const response = await fetch("http://tobiasdev.ml/api/authenticate", {
     headers: {
       Authorization: "Bearer " + localStorage.getItem("token"),
     },
   });
   if (response.ok) {
     const userID = await response.text();
     return userID;
   } else {
     throw new Error("Failed to get user ID");
   }
 }
 
 // 해당 전시회를 업로드한 유저 id 반환
 async function getAuthorId() {
   const id = new URL(window.location.href).searchParams.get("id");
   const response = await fetch(`http://tobiasdev.ml/services/exhibition/api/exhibitions/${id}`);
   if (response.ok) {
     const data = await response.json();
     const uploaderID = data.createdMemberDTO.login;
     return uploaderID;
   } else {
     throw new Error("Failed to get author ID");
   }
 }
 
 // 로그인한 사용자의 아이디와 글 작성자의 아이디 비교
 async function checkSameId() {
   try {
     const userID = await getUserId();
     const uploaderID = await getAuthorId();
    //  alert("userID: " + userID);
    //  alert("uploaderID: " + uploaderID);
     if (userID === uploaderID) {
       //아이디가 글 작성자의 아이디와 일치하는 경우
       document.getElementById("editBtn").style.display = "block";
       document.getElementById("deleteBtn").style.display = "block";
     } else {
       //아니면 버튼 가림
       document.getElementById("editBtn").style.display = "none";
       document.getElementById("deleteBtn").style.display = "none";
     }
   } catch (error) {
     console.error("Error: " + error);
   }
 }
 // 페이지 로드 시 checkSameId 함수를 호출하여 버튼 상태를 설정
 window.addEventListener("DOMContentLoaded", checkSameId);
 </script>
 
 <!--수정/삭제 버튼 이벤트 리스너-->
 <script>
   // editBtn 버튼 클릭 시
   document.getElementById("editBtn").addEventListener("click", function() {
     const id = new URL(window.location.href).searchParams.get("id");
     //해당 작품의 edit page로 이동
     window.location.href = `edit.html?id=${id}`;
   });
 
   // deleteBtn 버튼 클릭 시
   document.getElementById("deleteBtn").addEventListener("click", function() {
     var result = confirm("해당 작품을 삭제하시겠습니까?");
     if (result) {
       deleteContent();
     } else {
     }
   });
   
   async function deleteContent() {
   const id = new URL(window.location.href).searchParams.get("id");
   try {
     const response = await fetch(`http://tobiasdev.ml/services/exhibition/api/exhibitions/request/delete/${id}`, {
       method: "PATCH",
       headers: {
         Authorization: "Bearer " + localStorage.getItem("token"),
       },
     });
     if (response.ok) {
       window.location.href="list.html";
     } else {
       throw new Error("삭제 요청을 실패하였습니다.");
     }
   } catch (error) {
     console.error("Error: " + error);
     alert("삭제 요청을 실패하였습니다. 다시 시도해주세요.");
   }
 }
 </script>

  </body>
</html>